<!-- XML representation of JSON data -->
<!-- 
    "@Author  :   Siddharth Mittal",
    "@Version :   1.0",
    "@Contact :   siddharth.mittal@meduniwien.ac.at",
    "@License :   (C)Copyright 2024, Medical University of Vienna"
-->

<!-- NOTE for Analysis: For DUMMY/Analsis, set correct Visual field at two positions, one for the <stimulus> and another for <search_space>-->


<root>
  <!-- Path information -->
  <path_to_append>.../</path_to_append>
  <refine_fitting enable="True" refinefit_on_gpu="True"/> <!-- Execute refine fitting on GPU if sufficient GPU memory is available -->

  <!-- Stimulus data -->
  <stimulus>
    <!-- File path for stimulus -->
    <directory>/ceph/mri.meduniwien.ac.at/projects/physics/fmri/data/stimsim24/BIDS/derivatives/prfprepare/analysis-01/sub-001/stimuli</directory>
    <task>bar</task> <!--name of the stimulus, this will be used to find the file in the stimulus directory, ONLY one value is allowed-->  
    <visual_field>9</visual_field> <!-- Visual field Radius, NOTE: Use "10" for simulated data, else "9" -->
    <width>101</width>
    <height>101</height>
    <binarization enable="False" threshold="0"/> <!-- stimulus will be binarized if enabled, all values above threshold will be set to 1 and below to 0 -->	
    
    <!-- Compute model signals with high-res stimulus then downsample: "num_frames_downsampled" = your fMRI timecourse length, "slice_time_ref" for details see https://www.alivelearn.net/?p=1037 -->
    <high_temporal_resolution enable="true" num_frames_downsampled="240" slice_time_ref="0.5"/>
  </stimulus>

  <!-- Input Data -->
  <input_datasrc>    
    <BIDS enable="True" run_type="concatenated"> <!-- Set to "True" if the input data is organized in BIDS format, select "individual" or "concatenated" run type -->
      <basepath>/ceph/mri.meduniwien.ac.at/projects/physics/fmri/data/stimsim24/BIDS</basepath>
      <append_to_basepath>derivatives, prfprepare</append_to_basepath> <!-- specify if the "analysis-xx"  -->          
      <!-- <basepath>D:/results/fmri/generic/</basepath>           -->

      <!-- Directory name for results; backups created with timestamp if overwrite="True" -->
      <results_anaylsis_id overwrite="False">24_TestAnalaysisResults</results_anaylsis_id>
            
      <!-- 
        NOTE: Case sensitive, provide the exact values!!!
        For the analysis, sub, ses, task, run, hemi,
        either provide comma separated values or specify "all" (to go through every available analysis) 
        Sample: <analysis>01, 02</analysis> or <analysis>all</analysis>
      -->
      <analysis>01</analysis>
      <sub>001</sub>
      <hemi>all</hemi>

      <!--INDIVIDUAL Task/stimulus Analysis-->
      <individual>
        <ses>001nn</ses> <!-- comma separated values or specify "all" -->
        <run>01</run> <!-- comma separated values or specify "all" -->
      </individual>

      <!--CONCATENATED Analysis-->
      <concatenated>
        <concatenate_item>
          <ses>001</ses> <!-- ONLY one value is allowed-->
          <task>bar</task> <!-- ONLY one value is allowed-->
          <run>02</run> <!-- ONLY one value is allowed-->
        </concatenate_item>
        <concatenate_item>
          <ses>001</ses>
          <task>bar</task>
          <run>04</run>
        </concatenate_item>
      </concatenated>       
    </BIDS>

    <!--OR, make Bids False and specify directly single/multiple filepaths -->
    <fixed_paths>
      <measured_data_filepath> <!-- Measured input data filepaths -->
        <filepath>/ceph/mri.meduniwien.ac.at/projects/physics/fmri/data/tests/gem_generic_test/BIDS/sub-001/ses-3n2/func/sub-001_ses-3n2_task-prf_acq-normal_run-01_bold.nii.gz</filepath>
        <filepath>dummy////sub-001/ses-3n2/func/sub-001_ses-3n2_task-prf_acq-normal_run-01_bold.nii.gz</filepath>
      </measured_data_filepath>              
      <results> <!-- Results filepaths realted  -->
        <basepath>/ceph/mri.meduniwien.ac.at/projects/physics/fmri/data/tests/gem_generic_test/derivatives/prfanalyze-gem/analysis-01/sub-001/ses-3n2/</basepath> <!-- Base path for results -->    
        <custom_filename_postfix>_[gem-new_data-simulated_v1_151x151x8_refine-validation]</custom_filename_postfix> <!-- Custom filename postfix -->    
        <prepend_date>True</prepend_date> <!-- Flag to prepend date -->
      </results>
    </fixed_paths>
  </input_datasrc>

  <!-- Analysis Model -->
  <pRF_model>    
    <model>2d_gaussian</model> <!-- 2d_gauss, DoG, CSS -->
  </pRF_model>

  <!-- Measured data section -->
  <measured_data>
    <width>101</width>
    <height>101</height>
    <batches>4</batches>    
  </measured_data>

  <!-- GPU configuration -->
  <gpu>
    <!-- Default GPU -->
    <default_gpu>0</default_gpu>
    <!-- Additional available GPUs -->
    <additional_available_gpus>
      <gpu>1</gpu>
      <gpu>2</gpu>
      <gpu>3</gpu>
    </additional_available_gpus>
  </gpu>

  <!-- Search space information -->
  <search_space write_debug_info="false">    
    <!-- if the user wants to use custom HRF, pRF sizes or Spatial grid, provide the filepath to the H5 file and the keys for each parameter -->
    <optional_analysis_params enable="False" filepath="DIR_PATH/analysis_additional_params.h5">
      <hrf use_from_file="True" key="analysis_params/hrf_values"/>
      <sigmas use_from_file="True" key="analysis_params/sigmas"/>
      <spatial_grid_xy use_from_file="True" key="analysis_params/spatial_grid_xy"/>
    </optional_analysis_params>
    
    <!-- if the user wants to generate a rectilinear grid within the GEM-pRF program, specify the default values below. Please NOTE that these values will ONLY be used if their corresponding optional_analysis_params = False -->
    <default_hrf t="(0, 45, 1)" peak_delay="6.16" under_shoot_delay="12.0" peak_disp="0.85" under_disp="0.82" peak_to_undershoot="2.15" normalize="true"/> <!-- SPM parameters, "t" is fed to np.arange(start, stop, step), set "step" to a lower value in case of high temporal stimulus -->
    <default_spatial_grid visual_field_radius="13.5" num_horizontal_prfs="151" num_vertical_prfs="151"/>
    <default_sigmas num_sigmas="16" min_sigma="0.5" max_sigma="5"/>
  </search_space>
</root>
